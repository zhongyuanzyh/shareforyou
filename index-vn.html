<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ShareForYou YouTube Downloader</title>
    <link rel="stylesheet" type="text/css" href="./css/web.css">
    <link rel="icon" href="./images/favicon.ico" type="image/x-icon">
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript">
        function convert() {
            // setTimeout(convert,1000);
            if ($("input[type=text]").val() ==="") {
                alert("Vui lòng nhập địa chỉ kết nối video.");
                return false;
            }
            //var reg1 = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
            var reg = /https:\/\/(www+\.)+(youtube+\.)+(\/[\w- .\/?%&=]*)?/;
            var objExp=new RegExp(reg);
            var res = objExp.test($("#input").val());
            if (res === false){
                console.log(res);
                alert("Vui lòng nhập địa chỉ video youtube bắt đầu bằng https.");
                return false;
            }
            $.ajax({
                type: "POST",
                dataType: "json",
                beforeSend:function(){
                    $("#converter").hide();
                    $("#loading").show();
                    $(".loadingDiv").show();
                },
                url: "/mpx" ,//url
                data: $('#form1').serialize(),
                success: function (data) {
                    console.log(data);
                    if (data.error_code === 102 ){
                        $("#loading").hide();
                        $(".loadingDiv").hide();
                        $("#converter").hide();
                        $("#errorValue")[0].innerHTML = "Rất tiếc, video bạn đã tải xuống vượt quá 30 phút, chúng tôi tạm thời không hỗ trợ video đó!";
                        $("#errorContent").show();
                    }else if (data.error_code === 103){
                        $("#loading").hide();
                        $(".loadingDiv").hide();
                        $("#converter").hide();
                        $("#downloadContent a")[0].innerHTML = data.video_info.title;
                        $("#downloadLink a").attr("href",data.download_url);
                        $("#downloadContent").show();
                    }else if (data.error_code === 101){
                        $("#loading").hide();
                        $(".loadingDiv").hide();
                        $("#converter").hide();
                        $("#errorValue")[0].innerHTML = "Lỗi khi lấy thông tin video, vui lòng kiểm tra xem liên kết video có chính xác không!";
                        $("#errorContent").show();
                    }else if (data.error_code === 104){
                        $("#loading").hide();
                        $(".loadingDiv").hide();
                        $("#converter").hide();
                        $("#errorValue")[0].innerHTML = "Chúng tôi hiện chỉ có thể xử lý video từ trang web Youtube, vui lòng kiểm tra liên kết URL của bạn!";
                        $("#errorContent").show();
                    }
                },
                error : function(request) {
                    alert("bất thường!");
                },
            });
        }
        function langChange(){
            var nSel = document.getElementById("languageBox");
            var index = nSel.selectedIndex;
            var text = nSel.options[index].text;
            var value= nSel.options[index].value;
            if (value === "opt1"){
                window.location.href = "index-vn.html";
            }else if (value === "opt2"){
                window.location.href = "index-jp.html";
            }else if (value === "opt3"){
                window.location.href = "index-en.html";
            } else if (value === "opt4"){
                window.location.href = "index-th.html";
            }else if (value === "opt5"){
                window.location.href = "index.html";
            }else if(value === "opt6"){
                window.location.href = "index-mm.html";
            }
        }
    </script>
</head>
<body>
    <div id="nav">
        <a href="https://youtube.com" target="_blank">Youtube</a>
        <a href="https://google.com" target="_blank">Google</a>
        <a href="https://facebook.com" target="_blank">Facebook</a>
        <a href="https://instagram.com" target="_blank">Instagram</a>
    </div>
    <div>
        <label for="languageBox"></label><select id="languageBox" onChange="langChange();">
            <option value="opt1">Tiếng Việt</option>
            <option value="opt2">日本語</option>
            <option value="opt3">English</option>
            <option value="opt4">ไทย</option>
            <option value="opt5">中文</option>
            <option value="opt6">ဗမာ</option>
        </select>
    </div>
    <div id="content">
        <a href="">
            <img id="logo" src="./images/mp3.png" alt>
        </a>
        <div id="converter_wrapper">
            <div id="converter">
                <div id="title">Vui lòng nhập địa chỉ liên kết video YouTube</div>
            <form id="form1" onsubmit="return false" action="##" method="post">
                <label for="input"></label><input id="input" type="text" name="video" autocomplete="off" value="" autofocus>
                <input id="submit" type="button" value="Convert" onclick="convert()">
                <div id="checkbox">
                    Vui lòng chọn định dạng của kết quả chuyển đổi:
                    <label>
                        <input class="media" type="radio" name="format" value="mp3" checked>
                    </label>Âm thanh
                    <label>
                        <input class="media" type="radio" name="format" value="mp4">
                    </label>video
                </div>
            </form>
            </div>
            <div id="downloadContent">
              <div id="downloadTitle">Tải xuống URL của video YouTube sau khi chuyển đổi</div>
              <div id="downloadLink">
                <a href="" download></a> 
              </div>
            </div>
            <div id="progressContent">
                <div id="progressTitle">Tiến trình tải xuống tác vụ</div>
                <div id="progressValue"></div>
            </div>
            <div id="errorContent">
                <div id="errorTitle">Lỗi tải xuống video Youtube</div>
                <div id="errorValue"></div>
            </div>
            <div id="loading">
                <div id="progressTitle">Nhiệm vụ của bạn đang được xử lý</div>
                <div class="loadingDiv"></div>
            </div>
        </div>
    <div id="separator"></div>
    <div id="text">
        <h1>ShareForYou</h1>
        <p>Bằng cách sử dụng trình chuyển đổi của chúng tôi, bạn có thể dễ dàng chuyển đổi video YouTube sang tệp mp3 (âm thanh) hoặc mp4 (video) và tải xuống miễn phí - dịch vụ này phù hợp với máy tính, máy tính bảng và thiết bị di động.</p>
        <p>Video luôn được chuyển đổi ở chất lượng cao nhất hiện có. Xin lưu ý rằng chúng tôi chỉ có thể chuyển đổi tối đa 30 phút video - điều này có giới hạn, vì vậy bất kỳ chuyển đổi video nào sẽ không mất quá vài phút.</p>
        <p>Vui lòng cố gắng hết sức để giúp nhấp vào quảng cáo và chúng tôi sẽ sử dụng số tiền này làm thu nhập hoạt động. Dịch vụ của chúng tôi miễn phí và không yêu cầu bất kỳ cài đặt hoặc đăng ký phần mềm nào.</p>
        <p>Để chuyển đổi video, vui lòng sao chép URL video YouTube vào trình chuyển đổi của chúng tôi, chọn một định dạng và nhấp vào nút chuyển đổi. Sau khi chuyển đổi xong, bạn có thể tải xuống tệp bằng cách nhấp vào liên kết tải xuống.</p>
        <p>Hãy tận hưởng đi nhé! Hy vọng bạn thích dịch vụ của chúng tôi.</p>
    </div>
    </div>
    <div id="footer">
        <a href="author.html" target="_blank">Liên hệ với tác giả</a>
    </div>
</body>
</html>
