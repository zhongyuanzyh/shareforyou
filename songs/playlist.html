<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="shareforyou.online往期回顾，免费提供youtube音频、视频下载，支持pc、iPhone、Android、平板">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
    <!--以下css的加载顺序决定了自己的css是否被bootstrap的覆盖；还有thead不居中的问题，如果内联stylesheet，那优先级最高-->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="../css/rewindsongs.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>往期回顾</title>
    <script>
        var pageTotal=0;//总页数
        var rowTotal=0;//总行数
        var currentPage=0;//当前页数
        var startRow=0;//页开始行数
        var endRow=0;//页结束行数
        var pageSize=4;//每页行数

        // var tby = $( "#table tbody" );

        function getOldDaysPlayLists() {
            $.ajax({
                type: 'GET',
                url: "/rewindsongs",
                contentType: "application/json;cherset=utf-8",
                dataType: "json",
        //         success: function (data){
        //         $('.table_node').empty();
        //     //取出后端传过来的list值
        //     var chargeRuleLogs = data.song_details;
        //     //对list值进行遍历
        //     $.each(chargeRuleLogs, function (index, n) {
        //         var rowTr = document.createElement('tr');
        //         //找到html的tr节点
        //         rowTr.className = "tr_node";
        //         //将要展示的信息写入页面
        //         rowTr.innerHTML = "<td>" + chargeRuleLogs[index].song_date + "</td>"
        //             + "<td>" + chargeRuleLogs[index].song_name + "</td>";
        //         //将信息追加
        //         $(".table_node").append(rowTr)
        //     });
        // }
                success:function (data) {
                    rowTotal=data.number_of_songs;
                    pageTotal=Math.ceil(rowTotal/pageSize);
                    console.log(rowTotal,pageTotal);
                    currentPage = 1;
                    if (pageTotal === 1){
                        for(var i =0;i <pageSize;i++){
                            $( "#table tbody" ).append(
                                $("<tr><td>"+
                                data.song_details[i].song_date+
                                "</td><td>"+
                                data.song_details[i].song_name+
                                "</td></tr>")
                            )
                        }
                    }else {
                        for(var i =0;i <pageSize;i++){
                            $( "#table tbody" ).append(
                                $("<tr><td>"+
                                    data.song_details[i].song_date+
                                    "</td><td>"+
                                    data.song_details[i].song_name+
                                    "</td></tr>")
                            )
                        }
                        for(var i=1;i<pageTotal+1;i++){
                            $("#page_ul").append(
                                $("<li><a href='#'>"+i+"</a><li>")
                            );
                        }
                    }
                }
            });
        }
        function gotoPage(pageNum){
            $.ajax({
                url:"/rewindsongs",
                type:"GET",
                dataType:"json",
                success:function(data){
                    currentPage=pageNum;
                    startRow=pageSize*(pageNum-1);
                    endRow=startRow+pageSize;
                    endRow=(rowTotal>endRow)?endRow:rowTotal;
                    $( "#table tbody" ).empty();
                    for(var i=startRow;i<endRow;i++){
                        $("#table tbody").append(
                            $("<tr><td>"+
                                data.song_details[i].song_date+
                                "</td><td>"+
                                data.song_details[i].song_name+
                                "</td></tr>")
                        );
                    }

                }
            });
        }
        $(function () {
            $("#page_ul").on("click","li",function(){
                var pageNum=$(this).text();
                gotoPage(pageNum);
            });
            $("#page_prev").on("click","li",function(){
                //因为进入到前一页就意味着当前页必须减去1，是为了防止当前页码为0
                --currentPage;
                if(currentPage===0){

                }else{
                    gotoPage(currentPage);
                }
            });
            $("#page_next").on("click","li",function(){
                console.log(currentPage);
                if(currentPage===pageTotal){

                }else{
                    gotoPage(++currentPage);
                }
            })
        })
    </script>

</head>
<body onload="getOldDaysPlayLists()">
<div>
<table id="table">
    <thead>
    <tr>
        <th style="text-align: center">推荐日期</th>
        <th style="text-align: center">推荐曲目</th>
    </tr>
    </thead>

    <tbody class="table_node">
    <tr class="tr_node" >
        <!--动态载入数据-->
    </tr>
    <!-- more data -->
    </tbody>
    </table>
</div>
<nav align="center" id="page_nav">
    <ul class="pagination" id="page_prev">
        <li id="prev">
            <a href="#" aria-label="Previous">
                <span aria-hidden="true">«</span>
            </a>
        </li>
    </ul>
    <ul class="pagination" id="page_ul">

    </ul>
    <ul class="pagination" id="page_next">
        <li id="next">
            <a href="#" aria-label="Next">
                <span aria-hidden="true">»</span>
            </a>
        </li>
    </ul>
</nav>
</body>
</html>