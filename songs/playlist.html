<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="shareforyou.online往期回顾，免费提供youtube音频、视频下载，支持pc、iPhone、Android、平板">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
    <!--以下css的加载顺序决定了自己的css是否被bootstrap的覆盖；还有thead不居中的问题，如果内联stylesheet，那优先级最高-->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="../css/rewindsongs.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/2.1.1/jquery.min.js" data-cfasync="false"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js" data-cfasync="false"></script>
    <title>往期回顾</title>
    <!--要关闭cloudflare的rocket-loader对js的优化，否则大陆客户去访问网站的时候，需要去cf下载那个js，导致半天下载不下来，出现耗时过长的问题-->
    <script data-cfasync="false">
        var pageTotal=0;//总页数
        var rowTotal=0;//总行数
        var currentPage=0;//当前页数
        var startRow=0;//页开始行数
        var endRow=0;//页结束行数
        var pageSize=2;//每页行数

        // var tby = $( "#table tbody" );

        function getOldDaysPlayLists(ps) {
            $.ajax({
                type: 'GET',
                url: "/rewindsongs",
                contentType: "application/json;cherset=utf-8",
                dataType: "json",
        //         success: function (data){
        //         $('.table_node').empty();
        //     //取出后端传过来的list值
        //     var chargeRuleLogs = data.song_details;
        //     //对list值进行遍历
        //     $.each(chargeRuleLogs, function (index, n) {
        //         var rowTr = document.createElement('tr');
        //         //找到html的tr节点
        //         rowTr.className = "tr_node";
        //         //将要展示的信息写入页面
        //         rowTr.innerHTML = "<td>" + chargeRuleLogs[index].song_date + "</td>"
        //             + "<td>" + chargeRuleLogs[index].song_name + "</td>";
        //         //将信息追加
        //         $(".table_node").append(rowTr)
        //     });
        // }
                success:function (data) {
                    ps = pageSize;
                    rowTotal=data.number_of_songs;
                    pageTotal=Math.ceil(rowTotal/ps);
                    console.log(rowTotal,pageTotal);
                    currentPage = 1;
                    if (pageTotal === 1){
                        for(var i =0;i <ps;i++){
                            $( "#table tbody" ).append(
                                $("<tr><td>"+
                                data.song_details[i].song_date+
                                "</td><td>"+
                                data.song_details[i].song_name+
                                "</td></tr>")
                            )
                        }
                    }else {
                        for(var i =0;i <ps;i++){
                            $( "#table tbody" ).append(
                                $("<tr><td>"+
                                    data.song_details[i].song_date+
                                    "</td><td>"+
                                    data.song_details[i].song_name+
                                    "</td></tr>")
                            )
                        }
                        for(var i=1;i<pageTotal+1;i++){
                            $("#page_ul").append(
                                $("<li><a href='#'>"+i+"</a><li>")
                            );
                        }
                    }
                }
            });
        }
        function gotoPage(pageNum){
            $.ajax({
                url:"/rewindsongs",
                type:"GET",
                dataType:"json",
                success:function(data){
                    currentPage=pageNum;
                    console.log("当前页码是：",currentPage);
                    startRow=pageSize*(pageNum-1);
                    console.log("起始行是：",startRow);
                    console.log("全局pagesize是：",pageSize);
                    endRow=startRow+pageSize;
                    console.log("结束行是：",endRow);
                    endRow=(rowTotal>endRow)?endRow:rowTotal;
                    $( "#table tbody" ).empty();
                    for(var i=startRow;i<endRow;i++){
                        $("#table tbody").append(
                            $("<tr><td>"+
                                data.song_details[i].song_date+
                                "</td><td>"+
                                data.song_details[i].song_name+
                                "</td></tr>")
                        );
                    }

                }
            });
        }
        function selectChange(){
            // var perNum = $("#perPage").val();
            var perNum = $(this).text();
            console.log(perNum);
            pageSize = perNum;
            $("#page_ul").empty();
            $( "#table tbody" ).empty();
            getOldDaysPlayLists(perNum);
        }
        $(function () {
            $("#page_ul").on("click","li",function(){
                var pageNum=$(this).text();
                gotoPage(pageNum);
            });
            $("#page_prev").on("click","li",function(){
                //因为进入到前一页就意味着当前页必须减去1，是为了防止当前页码为0
                --currentPage;
                if(currentPage===0){

                }else{
                    gotoPage(currentPage);
                }
            });
            $("#page_next").on("click","li",function(){
                console.log(currentPage);
                if(currentPage===pageTotal){

                }else{
                    gotoPage(++currentPage);
                }
            })
        })
    </script>
</head>
<body onload="getOldDaysPlayLists()">
<div>
<table id="table">
    <thead>
    <tr>
        <th style="text-align: center">推荐日期</th>
        <th style="text-align: center">推荐曲目</th>
    </tr>
    </thead>

    <tbody class="table_node">
    <tr class="tr_node" >
        <!--动态载入数据-->
    </tr>
    <!-- more data -->
    </tbody>
    </table>
</div>
<nav align="right" id="page_nav">
    <label for="perPage">条数</label>
    <div class="pagination">
        <select id="perPage" class="form-control" onchange="selectChange()">
            <option value="2" selected>2</option>
            <option value="4">4</option>
            <option value="6">6</option>
        </select>
    </div>

    <ul class="pagination" id="page_prev">
        <li id="prev">
            <a href="#" aria-label="Previous">
                <span aria-hidden="true">«</span>
            </a>
        </li>
    </ul>
    <ul class="pagination" id="page_ul">

    </ul>
    <ul class="pagination" id="page_next">
        <li id="next">
            <a href="#" aria-label="Next">
                <span aria-hidden="true">»</span>
            </a>
        </li>
    </ul>
</nav>
</body>
</html>